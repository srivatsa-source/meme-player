<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ora Meme Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #f4f4f4, #e0e0e0);
      font-family: 'Poppins', sans-serif;
      color: #fff;
      transition: background 1s ease;
    }

    .player-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .card {
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      width: 320px;
      height: 480px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      transition: transform 0.5s ease, background 1s ease;
    }

    .meme-img {
      width: 100%;
      height: 60%;
      object-fit: contain;
      border-radius: 20px 20px 0 0;
      transition: transform 0.5s ease, opacity 400ms ease;
      opacity: 1;
      background: rgba(0, 0, 0, 0.2);
    }

    .song-info {
      text-align: center;
      margin-top: 6px;
      font-size: 0.9em;
      color: rgba(255,255,255,0.85);
    }

    .timeline {
      width: 80%;
      margin: 6px auto 4px auto;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      background: rgba(255,255,255,0.4);
      border-radius: 4px;
      outline: none;
    }

    .timeline::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      width: 80%;
      margin: 0 auto;
      font-size: 0.75em;
      color: rgba(255,255,255,0.7);
    }

    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      padding: 12px 0;
    }

    .external-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 50px;
      padding: 12px 24px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      flex-wrap: wrap;
    }

    button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.3em;
      color: #fff;
      transition: transform 0.3s ease, color 0.3s ease;
    }

    .controls button {
      font-size: 1.4em;
    }

    button:hover {
      transform: scale(1.2);
      color: #ddd;
    }

    .play {
      background: rgba(255,255,255,0.25);
      color: white;
      border-radius: 50%;
      width: 55px;
      height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    .play:hover {
      background: rgba(255,255,255,0.35);
      transform: scale(1.15);
    }

    .play.active {
      animation: pulse 1.2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.3); }
      70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(255,255,255,0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0); }
    }

    .share-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 8px;
      color: white;
      padding: 6px 10px;
      margin: 10px auto;
      display: inline-flex;
      gap: 8px;
      align-items: center;
      font-size: 0.9rem;
      cursor: pointer;
      /* smoother transitions: background, lift (transform), and shadow */
      transition: background 220ms ease, transform 220ms cubic-bezier(.2,.8,.2,1), box-shadow 220ms ease, color 220ms ease;
    }

    .share-btn:hover {
      /* gentle lift and slightly brighter background */
      transform: translateY(-4px) scale(1.02);
      background: rgba(255,255,255,0.34);
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      color: #fff;
    }

    .share-btn:active {
      /* subtle press feedback */
      transform: translateY(-2px) scale(0.995);
      box-shadow: 0 6px 14px rgba(0,0,0,0.22);
    }

    .share-btn:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(255,255,255,0.08);
    }

    /* Camera Modal */
    .camera-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 1rem;
    }
    .camera-modal.active {
      display: flex;
    }
    .camera-container {
      position: relative;
      max-width: 90%;
      max-height: 70vh;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
    }
    #cameraVideo {
      width: 100%;
      height: 100%;
      display: block;
      transform: scaleX(-1);
    }
    #cameraCanvas {
      display: none;
    }
    .camera-controls {
      margin-top: 1.5rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      position: relative;
      z-index: 10;
    }
    .camera-btn {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 50px;
      padding: 0.8rem 1.8rem;
      color: #fff;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      z-index: 10;
    }
    .camera-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
    }
    .camera-btn:active {
      transform: translateY(0);
    }
    .camera-btn.primary {
      background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
      color: #000;
      box-shadow: 0 8px 20px rgba(255,255,255,0.3);
    }
    .camera-btn.primary:hover {
      box-shadow: 0 12px 30px rgba(255,255,255,0.5);
    }
    .camera-btn.close-btn {
      background: rgba(255,50,50,0.8);
      border-color: rgba(255,100,100,0.5);
    }
    .camera-btn.close-btn:hover {
      background: rgba(255,70,70,0.9);
    }
    .camera-preview {
      margin-top: 1rem;
      text-align: center;
    }
    .camera-preview img {
      max-width: 300px;
      border-radius: 8px;
      border: 2px solid rgba(255,255,255,0.3);
    }

    /* full-page background layers for smooth crossfade */
    .page-bg-layer {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      transition: opacity 700ms ease;
      z-index: -2;
      opacity: 0;
      pointer-events: none;
    }
    /* ensure content sits above background layers */
    #card { z-index: 1; position: relative; }
    /* card pop effect when track changes */
    .card.pop { transform: scale(1.03); transition: transform 400ms cubic-bezier(.2,.8,.2,1); }
    /* confirmation check animation */
    #confirm {
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(20px) scale(0.8);
      bottom: 100px;
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 10px 14px;
      border-radius: 999px;
      display: flex;
      gap: 8px;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      z-index: 10000;
      transition: opacity 300ms ease, transform 300ms cubic-bezier(.2,.8,.2,1);
      font-size: 0.95rem;
    }
    #confirm.show { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
    #confirm svg { width: 20px; height: 20px; flex-shrink:0 }
    /* community badge shown in captures */
    #communityBadge {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      z-index: 5;
      pointer-events: none;
      display: none;
    }
    #communityBadge.show { display: block; }
    /* Meme Vault Modal */
    #vaultModal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(10px);
      z-index: 20000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    #vaultModal.show { display: flex; }
    .vault-content {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 24px;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .vault-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .vault-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
    }
    .vault-close {
      background: rgba(255,255,255,0.2);
      border: none;
      color: #fff;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      transition: background 0.2s;
    }
    .vault-close:hover { background: rgba(255,255,255,0.3); }
    .vault-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
    }
    .vault-item {
      aspect-ratio: 1;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      border: 2px solid transparent;
      transition: transform 0.2s, border-color 0.2s;
    }
    .vault-item:hover { transform: scale(1.05); }
    .vault-item.collected { border-color: #3ee07a; }
    .vault-item.locked {
      background: rgba(255,255,255,0.05);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .vault-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .vault-lock-icon {
      font-size: 2rem;
      color: rgba(255,255,255,0.3);
    }
    .vault-progress {
      text-align: center;
      margin-top: 16px;
      color: rgba(255,255,255,0.8);
      font-size: 0.9rem;
    }

    /* Meme Viewer Modal */
    #memeViewerModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    #memeViewerModal.show { display: flex; }
    .meme-viewer-content {
      max-width: 600px;
      max-height: 90vh;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-radius: 20px;
      padding: 24px;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .meme-viewer-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,255,255,0.1);
      border: none;
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .meme-viewer-close:hover { background: rgba(255,255,255,0.3); }
    .meme-viewer-image {
      max-width: 100%;
      max-height: 60vh;
      border-radius: 12px;
      object-fit: contain;
    }
    .meme-viewer-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .meme-viewer-btn {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .meme-viewer-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
    }

    /* Splash Screen - VHS/Retro Style */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #2b52ff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
      overflow: hidden;
    }
    .splash-screen.show {
      opacity: 1;
      visibility: visible;
    }
    
    /* VHS Effects */
    .splash-noise {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
      opacity: 0.3;
      pointer-events: none;
    }
    .splash-noise:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://ice-creme.de/images/background-noise.png');
      pointer-events: none;
      background-size: 200%;
    }
    .splash-noise-moving {
      opacity: 0.4;
      z-index: 2;
    }
    .splash-noise-moving:before {
      will-change: background-position;
      animation: noise 1s infinite alternate;
    }
    
    .splash-scanlines {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 3;
      opacity: 0.25;
      will-change: opacity;
      animation: opacity 3s linear infinite;
    }
    .splash-scanlines:before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 51%);
      background-size: 100% 4px;
      will-change: background, background-size;
      animation: scanlines 0.2s linear infinite;
    }
    
    /* VHS Text Overlays */
    .splash-vhs-play {
      position: absolute;
      left: 1.5rem;
      top: 1.5rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #fff;
      font-size: 1.2rem;
      z-index: 5;
      letter-spacing: 0.2em;
      animation: vhsGlitch 3s infinite;
    }
    .splash-vhs-slp {
      position: absolute;
      left: 1.5rem;
      bottom: 1.5rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #fff;
      font-size: 0.9rem;
      z-index: 5;
      letter-spacing: 0.1em;
      animation: vhsGlitch 4s infinite;
    }
    .splash-vhs-time {
      position: absolute;
      right: 1.5rem;
      top: 1.5rem;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #fff;
      font-size: 1rem;
      z-index: 5;
      animation: vhsGlitch 2.5s infinite;
    }
    
    @keyframes vhsGlitch {
      0%, 90%, 100% { 
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        transform: translate(0, 0);
      }
      92% { 
        text-shadow: 2px 0 2px rgba(255,0,0,0.8), -2px 0 2px rgba(0,255,255,0.8);
        transform: translate(-2px, 0);
      }
      94% { 
        text-shadow: -2px 0 2px rgba(255,0,0,0.8), 2px 0 2px rgba(0,255,255,0.8);
        transform: translate(2px, 0);
      }
      96% { 
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        transform: translate(0, 0);
      }
    }
    .splash-content {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(30px);
      border-radius: 24px;
      padding: 3rem 2.5rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.3);
      border: 1px solid rgba(255,255,255,0.15);
      animation: splashSlideUp 0.6s ease-out;
      position: relative;
      z-index: 10;
    }
    @keyframes splashSlideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .splash-logo {
      font-size: 4rem;
      color: #fff;
      margin-bottom: 1rem;
      animation: splashPulse 2s infinite;
      text-shadow: 0 0 20px rgba(255,255,255,0.5);
    }
    @keyframes splashPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .splash-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      margin: 0 0 0.5rem 0;
      animation: titleGlitch 5s infinite;
    }
    @keyframes titleGlitch {
      0%, 94%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.5), -1px 1px 8px rgba(255, 255, 255, 0.6);
        transform: translate(0, 0);
      }
      95% { 
        text-shadow: 3px 0 0 rgba(255,0,0,0.7), -3px 0 0 rgba(0,255,255,0.7);
        transform: translate(-3px, 0);
      }
      96% { 
        text-shadow: -3px 0 0 rgba(255,0,0,0.7), 3px 0 0 rgba(0,255,255,0.7);
        transform: translate(3px, 0);
      }
      97% {
        text-shadow: 0 0 10px rgba(255,255,255,0.5);
        transform: translate(0, 0);
      }
    }
    .splash-subtitle {
      font-size: 1.1rem;
      color: rgba(255,255,255,0.95);
      margin-bottom: 2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .splash-subtitle strong {
      color: #fff;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(255,255,255,0.8);
      animation: textGlitch 6s infinite;
    }
    @keyframes textGlitch {
      0%, 96%, 100% { 
        text-shadow: 0 0 10px rgba(255,255,255,0.8);
      }
      97% { 
        text-shadow: 2px 0 0 rgba(255,0,0,0.7), -2px 0 0 rgba(0,255,255,0.7);
      }
      98% { 
        text-shadow: -2px 0 0 rgba(255,0,0,0.7), 2px 0 0 rgba(0,255,255,0.7);
      }
    }
    .splash-instructions {
      background: rgba(0,0,0,0.25);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: left;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .splash-instructions h2 {
      font-size: 1.3rem;
      color: #fff;
      margin: 0 0 1rem 0;
      text-align: center;
      animation: textGlitch 4s infinite;
    }
    .splash-instructions ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .splash-instructions li {
      color: rgba(255,255,255,0.95);
      font-size: 1rem;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }
    .splash-instructions li:last-child {
      margin-bottom: 0;
    }
    .splash-instructions li i {
      color: #fff;
      font-size: 1.2rem;
      min-width: 24px;
      filter: drop-shadow(0 0 8px rgba(255,255,255,0.6));
    }
    .splash-instructions li strong {
      color: #fff;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(255,255,255,0.6);
    }
    .splash-start-btn {
      background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
      color: #000;
      border: none;
      border-radius: 50px;
      padding: 1rem 2.5rem;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
      transition: all 0.3s ease;
      box-shadow: 0 8px 20px rgba(255,255,255,0.3), 0 0 30px rgba(255,255,255,0.2);
      position: relative;
      overflow: hidden;
    }
    .splash-start-btn:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(43, 82, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }
    .splash-start-btn:hover:before {
      width: 300px;
      height: 300px;
    }
    .splash-start-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 30px rgba(255,255,255,0.5), 0 0 40px rgba(255,255,255,0.4);
      background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
    }
    .splash-start-btn:active {
      transform: translateY(-1px) scale(1.02);
    }
    .splash-start-btn i {
      font-size: 1rem;
      position: relative;
      z-index: 1;
    }
    .splash-start-btn span {
      position: relative;
      z-index: 1;
    }
    .splash-footer {
      margin-top: 1.5rem;
      color: rgba(255,255,255,0.7);
      font-size: 0.9rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Mobile Responsive - Camera Modal */
    @media (max-width: 600px) {
      .camera-container {
        max-width: 100%;
        max-height: 60vh;
      }
      .camera-controls {
        margin-top: 1rem;
        gap: 0.5rem;
      }
      .camera-btn {
        padding: 0.6rem 1.2rem;
        font-size: 0.85rem;
        gap: 0.4rem;
      }
      .camera-btn i {
        font-size: 0.9rem;
      }
      .camera-preview img {
        max-width: 200px;
      }
    }
    
    @media (max-width: 400px) {
      .camera-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
      }
      .camera-preview img {
        max-width: 150px;
      }
    }
    
    /* Mobile Responsive - Splash Screen */
    @media (max-width: 600px) {
      .player-container {
        gap: 16px;
      }
      .external-controls {
        gap: 10px;
        padding: 10px 20px;
      }
      .controls button {
        font-size: 1.2em;
      }
      .play {
        width: 48px;
        height: 48px;
      }
      .splash-content {
        padding: 2rem 1.5rem;
        width: 95%;
        max-width: none;
      }
      .splash-logo {
        font-size: 3rem;
      }
      .splash-title {
        font-size: 1.8rem;
      }
      .splash-subtitle {
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
      }
      .splash-instructions {
        padding: 1rem;
        margin-bottom: 1.5rem;
      }
      .splash-instructions h2 {
        font-size: 1.1rem;
        margin-bottom: 0.8rem;
      }
      .splash-instructions li {
        font-size: 0.9rem;
        margin-bottom: 0.7rem;
        gap: 0.6rem;
      }
      .splash-instructions li i {
        font-size: 1rem;
        min-width: 20px;
      }
      .splash-start-btn {
        padding: 0.9rem 2rem;
        font-size: 1rem;
        width: 100%;
        justify-content: center;
      }
      .splash-footer {
        font-size: 0.8rem;
        margin-top: 1rem;
      }
      .splash-vhs-play {
        font-size: 0.9rem;
        left: 1rem;
        top: 1rem;
      }
      .splash-vhs-slp {
        font-size: 0.75rem;
        left: 1rem;
        bottom: 1rem;
      }
      .splash-vhs-time {
        font-size: 0.85rem;
        right: 1rem;
        top: 1rem;
      }
    }
    
    @media (max-width: 400px) {
      .splash-content {
        padding: 1.5rem 1rem;
      }
      .splash-logo {
        font-size: 2.5rem;
        margin-bottom: 0.8rem;
      }
      .splash-title {
        font-size: 1.5rem;
      }
      .splash-subtitle {
        font-size: 0.85rem;
      }
      .splash-instructions h2 {
        font-size: 1rem;
      }
      .splash-instructions li {
        font-size: 0.85rem;
      }
      .splash-start-btn {
        padding: 0.8rem 1.5rem;
        font-size: 0.95rem;
      }
    }
    
    /* VHS Animations */
    @keyframes noise {
      0%, 100% {background-position: 0 0;}
      10% {background-position: -5% -10%;}
      20% {background-position: -15% 5%;}
      30% {background-position: 7% -25%;}
      40% {background-position: 20% 25%;}
      50% {background-position: -25% 10%;}
      60% {background-position: 15% 5%;}
      70% {background-position: 0 15%;}
      80% {background-position: 25% 35%;}
      90% {background-position: -10% 10%;}
    }
    @keyframes opacity {
      0% {opacity: 0.25;}
      20% {opacity: 0.15;}
      35% {opacity: 0.2;}
      50% {opacity: 0.3;}
      60% {opacity: 0.18;}
      80% {opacity: 0.25;}
      100% {opacity: 0.25;}
    }
    @keyframes scanlines {
      from {
        background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.5) 51%);
        background-size: 100% 4px;
      }
      to {
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5) 50%, transparent 51%);
        background-size: 100% 4px;
      }
    }

    /* Vault button */
    #vaultBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: background 220ms ease, transform 220ms ease;
      color: #fff;
      font-size: 1.3rem;
    }
    #vaultBtn:hover {
      background: rgba(255,255,255,0.34);
      transform: scale(1.1);
    }
    .vault-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #3ee07a;
      color: #000;
      border-radius: 10px;
      padding: 2px 6px;
      font-size: 0.7rem;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <!-- Welcome Splash Screen -->
  <div id="splashScreen" class="splash-screen show">
    <!-- VHS Effects -->
    <div class="splash-scanlines"></div>
    <div class="splash-noise"></div>
    <div class="splash-noise splash-noise-moving"></div>
    
    <!-- VHS Text Overlays -->
    <div class="splash-vhs-play">‚ñ∂ PLAY</div>
    <div class="splash-vhs-time" id="splashTime">00:00</div>
    <div class="splash-vhs-slp">SLP 0:00:00</div>
    
    <div class="splash-content">
      <div class="splash-logo">
        <i class="fa-solid fa-qrcode"></i>
      </div>
      <h1 class="splash-title">Welcome! üéâ</h1>
      <p class="splash-subtitle">You found a QR code made by <strong>@build__ora</strong></p>
      
      <div class="splash-instructions">
        <h2><i class="fa-solid fa-gamepad"></i> Collect All 15 Memes!</h2>
        <ul>
          <li><i class="fa-solid fa-music"></i> Play songs to unlock memes automatically</li>
          <li><i class="fa-solid fa-vault"></i> Check your vault (top-right) to see your collection</li>
          <li><i class="fa-solid fa-share-nodes"></i> Share your favorite memes on Instagram Stories</li>
          <li><i class="fa-brands fa-instagram"></i> Tag <strong>@build__ora</strong> to join our community!</li>
        </ul>
      </div>

      <button class="splash-start-btn" id="splashStartBtn">
        <i class="fa-solid fa-play"></i> <span>Start Collecting</span>
      </button>

      <p class="splash-footer">Made with ‚ù§Ô∏è by Build-Ora Community</p>
    </div>
  </div>

  <!-- Meme Vault Button -->
  <button id="vaultBtn" title="Meme Vault">
    <i class="fa-solid fa-vault"></i>
    <span class="vault-badge" id="vaultBadge">0/15</span>
  </button>

  <!-- Meme Vault Modal -->
  <div id="vaultModal">
    <div class="vault-content">
      <div class="vault-header">
        <div class="vault-title">üé® Meme Vault</div>
        <button class="vault-close" id="vaultClose">√ó</button>
      </div>
      <div class="vault-grid" id="vaultGrid"></div>
      <div class="vault-progress" id="vaultProgress">Collect all 15 memes by playing songs!</div>
    </div>
  </div>

  <!-- Meme Viewer Modal -->
  <div id="memeViewerModal">
    <div class="meme-viewer-content">
      <button class="meme-viewer-close" id="memeViewerClose">√ó</button>
      <img id="memeViewerImage" class="meme-viewer-image" src="" alt="Meme">
      <div class="meme-viewer-actions">
        <button class="meme-viewer-btn" id="shareMemeBtn">
          <i class="fa-brands fa-instagram"></i>
          Share
        </button>
        <button class="meme-viewer-btn" id="downloadMemeBtn">
          <i class="fa-solid fa-download"></i>
          Download
        </button>
      </div>
    </div>
  </div>

  <div id="bgA" class="page-bg-layer"></div>
  <div id="bgB" class="page-bg-layer"></div>
  
  <div class="player-container">
    <div class="card" id="card">
      <img id="memeImage" class="meme-img" src="https://source.unsplash.com/random/400x400?meme" alt="Random Meme" />
      <div class="song-info" id="songName">SoundHelix Song 1</div>
      <input id="timeline" class="timeline" type="range" value="0" min="0" max="100" />
      <div class="time-display">
        <span id="currentTime">0:00</span>
        <span id="duration">0:00</span>
      </div>
      <div class="controls">
        <button id="prev"><i class="fa-solid fa-backward-step"></i></button>
        <button id="playPause" class="play"><i class="fa-solid fa-play"></i></button>
        <button id="next"><i class="fa-solid fa-forward-step"></i></button>
      </div>
      <div id="toast" style="position:fixed;left:50%;transform:translateX(-50%);bottom:26px;background:rgba(0,0,0,0.7);color:#fff;padding:8px 12px;border-radius:8px;display:none;z-index:9999;font-size:0.9rem;"></div>
      <div id="confirm" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="11" stroke="rgba(255,255,255,0.2)" stroke-width="1.5" fill="rgba(255,255,255,0.05)"/><path d="M7 13l3 3 7-8" stroke="#3ee07a" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span id="confirmText">Done</span>
      </div>
      <div id="communityBadge">From Build-ora Community ¬∑ Join us!</div>
    </div>

    <!-- External Action Buttons -->
    <div class="external-controls">
      <button class="share-btn" id="shareBtn"><i class="fa-brands fa-instagram"></i> Share</button>
      <button class="share-btn" id="downloadBtn"><i class="fa-solid fa-download"></i> Download</button>
      <button class="share-btn" id="cameraBtn"><i class="fa-solid fa-camera"></i> Photo</button>
    </div>
  </div>

  <!-- Camera Modal -->
  <div id="cameraModal" class="camera-modal">
    <div class="camera-container">
      <video id="cameraVideo" autoplay playsinline></video>
      <canvas id="cameraCanvas"></canvas>
    </div>
    <div class="camera-controls">
      <button class="camera-btn" id="capturePhotoBtn">
        <i class="fa-solid fa-camera"></i> Capture Photo
      </button>
      <button class="camera-btn" id="retakeBtn" style="display:none;">
        <i class="fa-solid fa-rotate"></i> Retake
      </button>
      <button class="camera-btn primary" id="createPolaroidBtn" style="display:none;">
        <i class="fa-solid fa-images"></i> Create Polaroid
      </button>
      <button class="camera-btn close-btn" id="closeCameraBtn">
        <i class="fa-solid fa-xmark"></i> Close
      </button>
    </div>
    <div class="camera-preview" id="cameraPreview"></div>
  </div>

  <audio id="player"></audio>

  <!-- html2canvas: capture DOM as image for screen-download feature -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    // Playlist with 15 songs - each song unlocks 1 meme (15 songs = 15 memes)
    // Backgrounds cycle through the 5 available bg images
    const playlist = [
      { src: 'songs/Djo - End Of Beginning (Official Audio).mp3', name: 'Djo - End Of Beginning', bg: 'bg_img/bg_1.png', memeIds: [1] },
      { src: 'songs/imaseNIGHT DANCERMV.mp3', name: 'imase - NIGHT DANCER', bg: 'bg_img/bg_2.jpg', memeIds: [2] },
      { src: 'songs/JVKE - golden hour (official music video).mp3', name: 'JVKE - golden hour', bg: 'bg_img/bg_3.png', memeIds: [3] },
      { src: 'songs/Sapta Sagaradaache Ello - Title Track  Rakshit Shetty  Rukmini  Hemanth M Rao Charan Raj  Kapil.mp3', name: 'Sapta Sagaradaache Ello - Title Track', bg: 'bg_img/bg_4.jpg', memeIds: [4] },
      { src: 'songs/The Kid LAROI, Justin Bieber - Stay (Lyrics).mp3', name: 'The Kid LAROI & Justin Bieber - Stay', bg: 'bg_img/bg_5.jpg', memeIds: [5] },
      { src: 'songs/The Weeknd - Save Your Tears (Lyrics).mp3', name: 'The Weeknd - Save Your Tears', bg: 'bg_img/bg_1.png', memeIds: [6] },
      { src: 'songs/OneRepublic - Nobody (Lyrics).mp3', name: 'OneRepublic - Nobody', bg: 'bg_img/bg_2.jpg', memeIds: [7] },
      { src: 'songs/One Direction - Story of My Life.mp3', name: 'One Direction - Story of My Life', bg: 'bg_img/bg_3.png', memeIds: [8] },
      { src: 'songs/My Way.mp3', name: 'My Way', bg: 'bg_img/bg_4.jpg', memeIds: [9] },
      { src: "songs/Ain't Nobody (From DC).mp3", name: "Ain't Nobody", bg: 'bg_img/bg_5.jpg', memeIds: [10] },
      { src: 'songs/Arijit Singh, Pritam - Ae Dil Hai Mushkil (lyrics).mp3', name: 'Arijit Singh - Ae Dil Hai Mushkil', bg: 'bg_img/bg_1.png', memeIds: [11] },
      { src: 'songs/Ale Aleyo Audio Song   Savaari  Srinagara Kitty  Raghu Mukherjee  Kamalinee Mukherjee.mp3', name: 'Ale Aleyo - Savaari', bg: 'bg_img/bg_2.jpg', memeIds: [12] },
      { src: 'songs/Mungaru Male  Anisuthide Song Lyrics  Sonu Nigam Ganesh  Pooja Gandhi Manomurthy Yogaraj Bhat.mp3', name: 'Mungaru Male - Anisuthide', bg: 'bg_img/bg_3.png', memeIds: [13] },
      { src: 'songs/Ommomme Heegu Aaguvudu - Video Song  Hudugata  Golden Star Ganesh & Rekha Vedavyas Hit Song.mp3', name: 'Ommomme Heegu Aaguvudu - Hudugata', bg: 'bg_img/bg_4.jpg', memeIds: [14] },
      { src: 'songs/Oorum Blood  Dude  Pradeep Ranganathan, Mamitha Baiju  @SaiAbhyankkar  Paal Dabba Keerthiswaran.mp3', name: 'Oorum Blood - Dude', bg: 'bg_img/bg_5.jpg', memeIds: [15] }
    ];

  // For vault: we'll assume 15 unique memes exist (5 bg images cycle + extra slots for future)
  const TOTAL_MEMES = 15;

  // local meme placeholder used inside the player/card (keeps card separate from full-page background)
  const memePlaceholder = 'bg_img/meme_placeholder.svg';

  // Helper function to get a random collected meme or placeholder
  function getRandomMemeImage() {
    const collected = getCollectedMemes();
    if (collected.length === 0) {
      return memePlaceholder;
    }
    const randomIndex = Math.floor(Math.random() * collected.length);
    const memeId = collected[randomIndex];
    return memeId === 1 ? 'memes/meme 1.png' : `memes/meme ${memeId}.jpg`;
  }

  // index for meme/card image cycling (optional separate set) and current song index
  let current = 0;
  let currentSong = 0; // index into playlist
  const memeImage = document.getElementById('memeImage');
    const player = document.getElementById('player');
    const playPause = document.getElementById('playPause');
    const timeline = document.getElementById('timeline');
    const card = document.getElementById('card');
    const body = document.body;
    const songName = document.getElementById('songName');
  const currentTimeDisplay = document.getElementById('currentTime');
  const durationDisplay = document.getElementById('duration');
  const downloadBtn = document.getElementById('downloadBtn');
  const shareBtn = document.getElementById('shareBtn');
  const toast = document.getElementById('toast');
  const communityBadge = document.getElementById('communityBadge');
  // background layers for smooth crossfade
  const bgA = document.getElementById('bgA');
  const bgB = document.getElementById('bgB');
  let activeBg = 0; // 0 -> bgA visible, 1 -> bgB visible

    // Meme Vault: localStorage management
    let songsListenedFully = new Set();
    
    function getCollectedMemes() {
      const stored = localStorage.getItem('oraMemeVault');
      return stored ? JSON.parse(stored) : [];
    }
    function addCollectedMeme(memeId) {
      const collected = getCollectedMemes();
      if (!collected.includes(memeId)) {
        collected.push(memeId);
        localStorage.setItem('oraMemeVault', JSON.stringify(collected));
        updateVaultBadge();
        
        // Show special notification for new meme unlock
        showMemeUnlockNotification(memeId, collected.length);
      }
    }
    function showMemeUnlockNotification(memeId, totalCollected) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        z-index: 10001;
        animation: slideInRight 0.5s ease, fadeOut 0.5s ease 3.5s forwards;
        max-width: 300px;
        font-size: 0.95rem;
      `;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.8rem;">
          <i class="fa-solid fa-trophy" style="font-size: 1.5rem; color: #ffd700;"></i>
          <div>
            <div style="font-weight: bold; margin-bottom: 0.3rem;">üéâ New Meme Unlocked!</div>
            <div style="font-size: 0.85rem; opacity: 0.9;">Collected ${totalCollected}/${TOTAL_MEMES} memes</div>
          </div>
        </div>
      `;
      
      // Add animation keyframes if not exists
      if (!document.getElementById('memeNotifStyle')) {
        const style = document.createElement('style');
        style.id = 'memeNotifStyle';
        style.textContent = `
          @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes fadeOut {
            to { opacity: 0; transform: translateX(400px); }
          }
        `;
        document.head.appendChild(style);
      }
      
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }
    function updateVaultBadge() {
      const collected = getCollectedMemes();
      document.getElementById('vaultBadge').textContent = `${collected.length}/${TOTAL_MEMES}`;
    }
    function renderVault() {
      const collected = getCollectedMemes();
      const grid = document.getElementById('vaultGrid');
      grid.innerHTML = '';
      
      // Display all 15 memes from the memes folder
      for (let i = 1; i <= TOTAL_MEMES; i++) {
        const item = document.createElement('div');
        item.className = 'vault-item';
        if (collected.includes(i)) {
          item.classList.add('collected');
          // Use actual meme images
          const memeFile = i === 1 ? 'memes/meme 1.png' : `memes/meme ${i}.jpg`;
          const img = document.createElement('img');
          img.src = memeFile;
          img.alt = `Meme ${i}`;
          item.appendChild(img);
          
          // Make collected memes clickable
          item.style.cursor = 'pointer';
          item.onclick = () => openMemeViewer(memeFile);
        } else {
          item.classList.add('locked');
          const lock = document.createElement('i');
          lock.className = 'fa-solid fa-lock vault-lock-icon';
          item.appendChild(lock);
        }
        grid.appendChild(item);
      }
      document.getElementById('vaultProgress').textContent = 
        `Collected ${collected.length} of ${TOTAL_MEMES} memes. Keep playing to unlock more!`;
    }

    // Meme Viewer functionality
    function openMemeViewer(memeUrl) {
      document.getElementById('memeViewerImage').src = memeUrl;
      document.getElementById('memeViewerModal').classList.add('show');
      // Store current meme URL for share/download
      document.getElementById('memeViewerModal').dataset.currentMeme = memeUrl;
    }

    function closeMemeViewer() {
      document.getElementById('memeViewerModal').classList.remove('show');
    }

    // Meme Viewer event handlers
    document.getElementById('memeViewerClose').onclick = closeMemeViewer;
    document.getElementById('memeViewerModal').onclick = (e) => {
      if (e.target.id === 'memeViewerModal') closeMemeViewer();
    };

    // Share meme
    document.getElementById('shareMemeBtn').onclick = async () => {
      const memeUrl = document.getElementById('memeViewerModal').dataset.currentMeme;
      try {
        const response = await fetch(memeUrl);
        const blob = await response.blob();
        const file = new File([blob], 'meme.jpg', { type: 'image/jpeg' });
        
        if (navigator.share && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'Check out this meme!',
            text: 'From Ora Meme Player'
          });
        } else {
          // Fallback: copy to clipboard or download
          showToast('Share not supported. Try download instead!', 2000);
        }
      } catch (err) {
        console.error('Share failed:', err);
        showToast('Share failed. Try download!', 2000);
      }
    };

    // Download meme
    document.getElementById('downloadMemeBtn').onclick = async () => {
      const memeUrl = document.getElementById('memeViewerModal').dataset.currentMeme;
      try {
        const response = await fetch(memeUrl);
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = memeUrl.split('/').pop();
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast('Meme downloaded!', 2000);
      } catch (err) {
        console.error('Download failed:', err);
        showToast('Download failed!', 2000);
      }
    };

    // Vault UI handlers
    document.getElementById('vaultBtn').onclick = () => {
      renderVault();
      document.getElementById('vaultModal').classList.add('show');
    };
    document.getElementById('vaultClose').onclick = () => {
      document.getElementById('vaultModal').classList.remove('show');
    };
    document.getElementById('vaultModal').onclick = (e) => {
      if (e.target.id === 'vaultModal') {
        document.getElementById('vaultModal').classList.remove('show');
      }
    };

    // initialize first playlist item without crossfade (instant)
    function initPlaylist(index) {
      currentSong = ((index % playlist.length) + playlist.length) % playlist.length;
      const item = playlist[currentSong];
      // set bgA as the initial visible background
      bgA.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.45)), url('${item.bg}')`;
      bgA.style.opacity = '1';
      bgB.style.opacity = '0';
      activeBg = 0;
      // set player and UI
      player.src = item.src;
      songName.textContent = item.name;
      // Show a random collected meme or placeholder
      memeImage.style.opacity = '0';
      memeImage.onload = () => { memeImage.style.opacity = '1'; memeImage.onload = null; };
      memeImage.src = getRandomMemeImage();
      
      // Don't collect meme on init - require full listen
      
      player.play().catch(() => {});
      const icon = document.querySelector('#playPause i');
      if (icon) icon.classList.replace('fa-play', 'fa-pause');
      playPause.classList.add('active');
    }

    // applyPlaylist performs a smooth crossfade between bg layers and a subtle card pop
    function applyPlaylist(index) {
      currentSong = ((index % playlist.length) + playlist.length) % playlist.length;
      const item = playlist[currentSong];
      // prepare next background layer
      const nextBg = activeBg === 0 ? bgB : bgA;
      const currBg = activeBg === 0 ? bgA : bgB;
      nextBg.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.45)), url('${item.bg}')`;
      // trigger crossfade
      nextBg.style.opacity = '1';
      currBg.style.opacity = '0';
      activeBg = 1 - activeBg;

      // update audio and UI
      player.src = item.src;
      songName.textContent = item.name;

      // Show a random collected meme or placeholder
      memeImage.style.opacity = '0';
      memeImage.onload = () => { memeImage.style.opacity = '1'; memeImage.onload = null; };
      memeImage.src = getRandomMemeImage();

      // Don't collect meme when track changes - require full listen

      // subtle card pop
      card.classList.add('pop');
      setTimeout(() => card.classList.remove('pop'), 500);

      // play and update play button state
      player.play().catch(() => {});
      const icon = document.querySelector('#playPause i');
      if (icon) icon.classList.replace('fa-play', 'fa-pause');
      playPause.classList.add('active');
    }

    // sanitize filename for download
    function sanitizeFilename(name) {
      return name.replace(/[^a-z0-9\-_.]/gi, '_');
    }

    // Capture the player card and background at the requested resolution (cover scale)
    function captureCardAsBlob(targetW = 1080, targetH = 1920) {
      return new Promise((resolve, reject) => {
        const actions = document.getElementById('cardActions');
        const prevVisibility = actions ? actions.style.visibility : null;
        // hide share/download actions so they don't appear in the capture
        if (actions) actions.style.visibility = 'hidden';
        // show community badge for capture
        communityBadge.classList.add('show');

        // capture the entire body (includes backgrounds + card + badge)
        const opts = { useCORS: true, backgroundColor: null, scale: 1 };
        html2canvas(document.body, opts).then(srcCanvas => {
          // restore actions visibility and hide badge
          if (actions) actions.style.visibility = prevVisibility || '';
          communityBadge.classList.remove('show');

          // create destination canvas with target dimensions
          const dest = document.createElement('canvas');
          dest.width = targetW;
          dest.height = targetH;
          const ctx = dest.getContext('2d');

          // compute cover scale to fill target while preserving aspect ratio
          const sw = srcCanvas.width;
          const sh = srcCanvas.height;
          const scale = Math.max(targetW / sw, targetH / sh);
          const dw = Math.round(sw * scale);
          const dh = Math.round(sh * scale);
          const dx = Math.round((targetW - dw) / 2);
          const dy = Math.round((targetH - dh) / 2);

          // fill background with black for stories
          ctx.fillStyle = '#000';
          ctx.fillRect(0, 0, targetW, targetH);

          ctx.drawImage(srcCanvas, dx, dy, dw, dh);
          dest.toBlob((blob) => {
            if (blob) resolve(blob);
            else reject(new Error('Export failed'));
          }, 'image/png', 0.95);
        }).catch(err => {
          if (actions) actions.style.visibility = prevVisibility || '';
          communityBadge.classList.remove('show');
          reject(err);
        });
      });
    }

    // decorate the image by drawing song title and a small progress bar onto a canvas
    function decorateImage(imageURL) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => {
          const w = img.naturalWidth || 1200;
          const h = img.naturalHeight || 1200;
          const canvas = document.createElement('canvas');
          canvas.width = w;
          canvas.height = h;
          const ctx = canvas.getContext('2d');
          // draw image
          ctx.drawImage(img, 0, 0, w, h);
          // draw a semi-transparent overlay at bottom
          const overlayH = Math.round(h * 0.18);
          ctx.fillStyle = 'rgba(0,0,0,0.45)';
          ctx.fillRect(0, h - overlayH, w, overlayH);
          // draw play icon
          const pad = Math.round(overlayH * 0.18);
          const iconSize = Math.round(overlayH * 0.5);
          const iconX = pad;
          const iconY = h - overlayH/2;
          ctx.fillStyle = '#fff';
          ctx.beginPath();
          ctx.moveTo(iconX, iconY - iconSize/2);
          ctx.lineTo(iconX, iconY + iconSize/2);
          ctx.lineTo(iconX + iconSize * 0.9, iconY);
          ctx.closePath();
          ctx.fill();
          // draw song title
          ctx.fillStyle = '#fff';
          const fontSize = Math.round(overlayH * 0.32);
          ctx.font = `${fontSize}px Poppins, sans-serif`;
          ctx.textBaseline = 'middle';
          const textX = iconX + iconSize + pad;
          const maxTextWidth = w - textX - pad;
          const title = songName.textContent || '';
          ctx.fillText(title, textX, iconY - 8, maxTextWidth);
          // draw a tiny progress bar under the title
          const barW = Math.min(220, Math.round(w * 0.35));
          const barH = Math.max(6, Math.round(overlayH * 0.12));
          const barX = textX;
          const barY = iconY + Math.round(overlayH * 0.18);
          ctx.fillStyle = 'rgba(255,255,255,0.15)';
          ctx.fillRect(barX, barY, barW, barH);
          const frac = (player.duration && !isNaN(player.duration)) ? Math.max(0, Math.min(1, player.currentTime / player.duration)) : 0;
          ctx.fillStyle = '#3ee07a';
          ctx.fillRect(barX, barY, Math.round(barW * frac), barH);
          // export blob
          canvas.toBlob((blob) => {
            if (blob) resolve(blob);
            else reject(new Error('Canvas export failed'));
          }, 'image/png', 0.95);
        };
        img.onerror = (e) => reject(e);
        img.src = imageURL;
      });
    }

    // next / prev helpers
    function nextTrack() { applyPlaylist(currentSong + 1); }
    function prevTrack() { applyPlaylist(currentSong - 1); }

    document.getElementById('next').onclick = () => nextTrack();
    document.getElementById('prev').onclick = () => prevTrack();

    // Track song completion to unlock memes
    player.addEventListener('timeupdate', () => {
      const item = playlist[currentSong];
      const duration = player.duration;
      const currentTime = player.currentTime;
      
      // Check if song is at least 90% complete
      if (duration && currentTime / duration >= 0.9) {
        const songKey = `${item.src}`;
        if (!songsListenedFully.has(songKey)) {
          songsListenedFully.add(songKey);
          // Unlock all 3 memes for this song after listening to 90%
          item.memeIds.forEach(memeId => {
            addCollectedMeme(memeId);
          });
        }
      }
    });

    // advance automatically when a track ends
    player.onended = () => nextTrack();

    // helper: show small toast
    function showToast(msg, ms = 3000) {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, ms);
    }

    // small confirmation with check animation
    const confirmEl = document.getElementById('confirm');
    const confirmText = document.getElementById('confirmText');
    function showConfirm(text = 'Done', ms = 1200) {
      confirmText.textContent = text;
      confirmEl.classList.add('show');
      setTimeout(() => confirmEl.classList.remove('show'), ms);
    }

    // VHS timer animation on splash screen
    let splashTimer = 0;
    const splashTimeEl = document.getElementById('splashTime');
    const splashInterval = setInterval(() => {
      if (!document.getElementById('splashScreen').classList.contains('show')) {
        clearInterval(splashInterval);
        return;
      }
      splashTimer++;
      const mins = Math.floor(splashTimer / 60);
      const secs = splashTimer % 60;
      splashTimeEl.textContent = `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }, 1000);

    // Splash screen start button
    document.getElementById('splashStartBtn').onclick = () => {
      document.getElementById('splashScreen').classList.remove('show');
      clearInterval(splashInterval);
      // play first song after splash
      setTimeout(() => {
        const icon = document.querySelector('#playPause i');
        if (player.paused) {
          player.play();
          if (icon) icon.classList.replace('fa-play', 'fa-pause');
          playPause.classList.add('active');
        }
      }, 300);
    };

    window.onload = () => {
      // start at first playlist item (init without crossfade)
      updateVaultBadge();
      initPlaylist(0);
      // pause until user clicks start
      player.pause();
      const icon = document.querySelector('#playPause i');
      if (icon) icon.classList.replace('fa-pause', 'fa-play');
      playPause.classList.remove('active');
    };

    playPause.onclick = () => {
      const icon = document.querySelector('#playPause i');
      if (player.paused) {
        player.play();
        icon.classList.replace('fa-play', 'fa-pause');
        playPause.classList.add('active');
      } else {
        player.pause();
        icon.classList.replace('fa-pause', 'fa-play');
        playPause.classList.remove('active');
      }
    };

    player.ontimeupdate = () => {
      timeline.value = (player.currentTime / player.duration) * 100;
      currentTimeDisplay.textContent = formatTime(player.currentTime);
      durationDisplay.textContent = formatTime(player.duration);
    };

    function formatTime(time) {
      if (isNaN(time)) return '0:00';
      const minutes = Math.floor(time / 60);
      const seconds = Math.floor(time % 60).toString().padStart(2, '0');
      return `${minutes}:${seconds}`;
    }

    timeline.oninput = () => {
      player.currentTime = (timeline.value / 100) * player.duration;
    };

    document.getElementById('shareBtn').onclick = () => {
      const currentItem = playlist[currentSong];
      const imageURL = currentItem.bg;
      // new caption format: song name, tag, hashtags and a short URL
      const caption = `${songName.textContent} \n\nListen & share @build__ora \n#OraMeme #BuildOra \nhttps://build-ora.com`;

      // Try to capture the card at story resolution and share that image
      captureCardAsBlob(1080, 1920).then(blob => {
        const safeName = sanitizeFilename(songName.textContent || 'ora-image') + '.png';
        const file = new File([blob], safeName, { type: 'image/png' });
        if (navigator.canShare && navigator.canShare({ files: [file] }) && navigator.share) {
          navigator.share({ files: [file], text: caption }).then(() => {
            showConfirm('Shared');
          }).catch(() => {
            navigator.clipboard && navigator.clipboard.writeText(caption).catch(() => {});
            const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
            window.open(storyURL, '_blank');
            showToast('Caption copied to clipboard ‚Äî paste and tag @build__ora in Instagram.');
            showConfirm('Caption copied');
          });
        } else {
          navigator.clipboard && navigator.clipboard.writeText(caption).then(() => {
            const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
            window.open(storyURL, '_blank');
            showToast('Caption copied to clipboard ‚Äî paste into Instagram and tag @build__ora.');
            showConfirm('Caption copied');
          }).catch(() => {
            const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
            window.open(storyURL, '_blank');
            showToast('Opened Instagram composer; please add the song and tag @build__ora manually.');
          });
        }
      }).catch(err => {
        console.error('captureCardAsBlob failed', err);
        // fallback to decorated image
        decorateImage(imageURL).then(blob => {
          const safeName = sanitizeFilename(songName.textContent || 'ora-image') + '.png';
          const file = new File([blob], safeName, { type: 'image/png' });
          if (navigator.canShare && navigator.canShare({ files: [file] }) && navigator.share) {
            navigator.share({ files: [file], text: caption }).then(() => showConfirm('Shared')).catch(() => {
              navigator.clipboard && navigator.clipboard.writeText(caption).catch(() => {});
              const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
              window.open(storyURL, '_blank');
              showToast('Caption copied to clipboard ‚Äî paste and tag @build__ora in Instagram.');
            });
          } else {
            navigator.clipboard && navigator.clipboard.writeText(caption).then(() => {
              const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
              window.open(storyURL, '_blank');
              showToast('Caption copied to clipboard ‚Äî paste into Instagram and tag @build__ora.');
            }).catch(() => {
              const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
              window.open(storyURL, '_blank');
              showToast('Opened Instagram composer; please add the song and tag @build__ora manually.');
            });
          }
        }).catch(() => {
          navigator.clipboard && navigator.clipboard.writeText(caption).catch(() => {});
          const storyURL = `https://www.instagram.com/stories/create/?media=${encodeURIComponent(imageURL)}`;
          window.open(storyURL, '_blank');
          showToast('Opened Instagram composer; caption copied where possible.');
        });
      });
    };

    // Download whatever is currently visible on screen (capture viewport). Falls back to decorated image.
    document.getElementById('downloadBtn').onclick = () => {
      const currentItem = playlist[currentSong];
      const imageURL = currentItem.bg;

      // capture the player card at story resolution (1080x1920)
      captureCardAsBlob(1080, 1920).then(blob => {
        const safeName = sanitizeFilename(songName.textContent || 'ora-screenshot') + '.png';
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = safeName; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        showConfirm('Downloaded');
      }).catch(err => {
        console.error('captureCardAsBlob failed', err);
        // fallback: try html2canvas of full page
        if (typeof html2canvas === 'function') {
          showToast('Preparing screenshot...', 2000);
          html2canvas(document.documentElement, { useCORS: true, scale: Math.max(1, window.devicePixelRatio || 1) }).then(canvas => {
            canvas.toBlob((blob) => {
              if (!blob) { showToast('Failed to create image.'); return; }
              const safeName = sanitizeFilename(songName.textContent || 'ora-screenshot') + '.png';
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a'); a.href = url; a.download = safeName; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
              showConfirm('Downloaded');
            }, 'image/png', 0.95);
          }).catch(e => { console.error(e); showToast('Failed to download image.'); });
        } else {
          // last resort: decorated single-image
          decorateImage(imageURL).then(blob => {
            const safeName = sanitizeFilename(songName.textContent || 'ora-image') + '.png';
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = safeName; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
            showConfirm('Downloaded');
          }).catch(e => { console.error(e); showToast('Failed to download image.'); });
        }
      });
    };

    // Camera functionality
    let cameraStream = null;
    let capturedPhotoBlob = null;
    const cameraModal = document.getElementById('cameraModal');
    const cameraVideo = document.getElementById('cameraVideo');
    const cameraCanvas = document.getElementById('cameraCanvas');
    const cameraPreview = document.getElementById('cameraPreview');
    const capturePhotoBtn = document.getElementById('capturePhotoBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const createPolaroidBtn = document.getElementById('createPolaroidBtn');
    const closeCameraBtn = document.getElementById('closeCameraBtn');

    // Open camera
    document.getElementById('cameraBtn').onclick = async () => {
      try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'user', width: { ideal: 1080 }, height: { ideal: 1920 } } 
        });
        cameraVideo.srcObject = cameraStream;
        cameraModal.classList.add('active');
        cameraPreview.innerHTML = '';
        capturedPhotoBlob = null;
        capturePhotoBtn.style.display = 'inline-flex';
        retakeBtn.style.display = 'none';
        createPolaroidBtn.style.display = 'none';
      } catch (err) {
        showToast('Camera access denied or unavailable.');
        console.error(err);
      }
    };

    // Capture photo from video
    capturePhotoBtn.onclick = () => {
      const video = cameraVideo;
      cameraCanvas.width = video.videoWidth;
      cameraCanvas.height = video.videoHeight;
      const ctx = cameraCanvas.getContext('2d');
      ctx.save();
      ctx.scale(-1, 1);
      ctx.drawImage(video, -cameraCanvas.width, 0, cameraCanvas.width, cameraCanvas.height);
      ctx.restore();
      
      cameraCanvas.toBlob(blob => {
        capturedPhotoBlob = blob;
        const img = document.createElement('img');
        img.src = URL.createObjectURL(blob);
        cameraPreview.innerHTML = '';
        cameraPreview.appendChild(img);
        capturePhotoBtn.style.display = 'none';
        retakeBtn.style.display = 'inline-flex';
        createPolaroidBtn.style.display = 'inline-flex';
      }, 'image/png');
    };

    // Retake photo
    retakeBtn.onclick = (e) => {
      e.preventDefault();
      e.stopPropagation();
      cameraPreview.innerHTML = '';
      capturedPhotoBlob = null;
      capturePhotoBtn.style.display = 'inline-flex';
      retakeBtn.style.display = 'none';
      createPolaroidBtn.style.display = 'none';
    };

    // Close camera
    const closeCamera = () => {
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraStream = null;
      }
      cameraModal.classList.remove('active');
      cameraModal.style.display = 'none';
      cameraVideo.srcObject = null;
      cameraPreview.innerHTML = '';
      capturedPhotoBlob = null;
      capturePhotoBtn.style.display = 'inline-flex';
      retakeBtn.style.display = 'none';
      createPolaroidBtn.style.display = 'none';
    };

    closeCameraBtn.onclick = (e) => {
      e.preventDefault();
      e.stopPropagation();
      closeCamera();
    };
    
    // Also add as event listener for redundancy
    closeCameraBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      closeCamera();
    });

    // Create dual polaroid frame
    createPolaroidBtn.onclick = async () => {
      if (!capturedPhotoBlob) {
        showToast('Please capture a photo first.');
        return;
      }

      showToast('Creating polaroid frames...', 2000);

      // Hide camera modal temporarily to capture player screen
      cameraModal.style.display = 'none';
      
      // Wait a moment for modal to hide
      await new Promise(resolve => setTimeout(resolve, 100));

      // Get player screenshot (capture the actual player screen)
      const playerBlob = await captureCardAsBlob(1080, 1920);

      // Show camera modal again
      cameraModal.style.display = 'flex';

      // Create dual polaroid canvas (Instagram story size: 1080x1920)
      const polaroidCanvas = document.createElement('canvas');
      polaroidCanvas.width = 1080;
      polaroidCanvas.height = 1920;
      const ctx = polaroidCanvas.getContext('2d');

      // VHS Blue background (same as splash screen)
      ctx.fillStyle = '#2b52ff';
      ctx.fillRect(0, 0, 1080, 1920);

      // Add subtle noise texture
      ctx.globalAlpha = 0.15;
      for (let i = 0; i < 10000; i++) {
        ctx.fillStyle = Math.random() > 0.5 ? '#fff' : '#000';
        ctx.fillRect(Math.random() * 1080, Math.random() * 1920, 1, 1);
      }
      ctx.globalAlpha = 1.0;

      // Add diagonal "build-ora" watermark pattern
      ctx.save();
      ctx.font = 'bold 80px Arial';
      ctx.fillStyle = 'rgba(255, 255, 255, 0.08)';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      // Rotate canvas for diagonal text
      const spacing = 300;
      for (let y = -500; y < 2500; y += spacing) {
        for (let x = -200; x < 1300; x += 500) {
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(-45 * Math.PI / 180);
          ctx.fillText('build-ora', 0, 0);
          ctx.restore();
        }
      }
      ctx.restore();

      // Helper to draw polaroid frame
      const drawPolaroid = async (imageBlob, x, y, width, height) => {
        const img = await createImageBitmap(imageBlob);
        
        // Polaroid frame (white border)
        ctx.fillStyle = '#fff';
        ctx.shadowColor = 'rgba(0,0,0,0.3)';
        ctx.shadowBlur = 20;
        ctx.shadowOffsetY = 10;
        ctx.fillRect(x - 20, y - 20, width + 40, height + 100);
        ctx.shadowBlur = 0;
        ctx.shadowOffsetY = 0;
        
        // Image - maintain aspect ratio, contain within frame
        const imgAspect = img.width / img.height;
        const frameAspect = width / height;
        let drawWidth, drawHeight, drawX, drawY;
        
        if (imgAspect > frameAspect) {
          // Image is wider, fit to width
          drawWidth = width;
          drawHeight = width / imgAspect;
          drawX = x;
          drawY = y + (height - drawHeight) / 2;
        } else {
          // Image is taller, fit to height
          drawHeight = height;
          drawWidth = height * imgAspect;
          drawX = x + (width - drawWidth) / 2;
          drawY = y;
        }
        
        // Fill background with white in case of letterboxing
        ctx.fillStyle = '#fff';
        ctx.fillRect(x, y, width, height);
        
        ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
      };

      // Draw both polaroids
      const polaroidW = 900;
      const polaroidH = 550;
      const centerX = (1080 - polaroidW) / 2;
      
      // Top polaroid (user photo with QR) - smaller
      await drawPolaroid(capturedPhotoBlob, centerX, 120, polaroidW, polaroidH);
      
      // Add "With QR Code" text on white polaroid background
      ctx.fillStyle = '#000';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.shadowColor = 'transparent';
      ctx.shadowBlur = 0;
      ctx.fillText('üì∏ My QR Discovery', 540, 120 + polaroidH + 50);

      // Bottom polaroid (player screenshot) - larger to show details
      const playerPolaroidH = 800;
      await drawPolaroid(playerBlob, centerX, 850, polaroidW, playerPolaroidH);
      
      // Add "My Meme" text on white polaroid background
      ctx.fillStyle = '#000';
      ctx.fillText('üéµ ' + (songName.textContent || 'My Meme'), 540, 850 + playerPolaroidH + 50);

      // Add @build__ora branding
      ctx.font = 'bold 36px Arial';
      ctx.fillStyle = '#fff';
      ctx.shadowColor = 'rgba(0,0,0,0.7)';
      ctx.shadowBlur = 12;
      ctx.fillText('@build__ora', 540, 1780);
      ctx.shadowBlur = 0;

      // Convert to blob and share/download
      polaroidCanvas.toBlob(async (blob) => {
        const url = URL.createObjectURL(blob);
        
        // Try to share
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [new File([blob], 'polaroid.png', { type: 'image/png' })] })) {
          try {
            await navigator.share({
              files: [new File([blob], 'build-ora-polaroid.png', { type: 'image/png' })],
              title: 'My Build-Ora Experience',
              text: 'Found this awesome QR code from @build__ora! üéµ #BuildOra'
            });
            showConfirm('Shared!');
          } catch (err) {
            if (err.name !== 'AbortError') {
              // Fallback to download
              const a = document.createElement('a');
              a.href = url;
              a.download = 'build-ora-polaroid.png';
              document.body.appendChild(a);
              a.click();
              a.remove();
              showToast('Polaroid downloaded! Share it on Instagram and tag @build__ora');
            }
          }
        } else {
          // Download
          const a = document.createElement('a');
          a.href = url;
          a.download = 'build-ora-polaroid.png';
          document.body.appendChild(a);
          a.click();
          a.remove();
          showToast('Polaroid downloaded! Share it on Instagram and tag @build__ora');
        }
        
        URL.revokeObjectURL(url);
        
        // Close camera modal using the close function
        closeCamera();
      }, 'image/png');
    };
  </script>
</body>
</html>
